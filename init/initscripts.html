<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.0" />
<title></title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 0.25em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
</div>
<h2 id="_starting_jobs_at_boot">Starting jobs at boot</h2>
<div class="sectionbody">
<div class="paragraph"><p>Starting jobs at system boot is generally platform specific. RHEL and CentOS use
a traditional "sysvinit" mechanism, Ubuntu uses "upstart", and Mac OS X uses
"launchd". They are all featureful in their own ways. These are quick notes on
the minimum needed to run a daemon at boot on each one.</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="sidebar-title">Sometimes there&#8217;s an easier way</div>
<div class="paragraph"><p>You might find my <a href="http://tkhanson.net/pmtr">pmtr tool</a> much easier to use than
writing your initscript. Initscripts are typically used to start low-level
services that are shipped with the operating system.</p></div>
</div></div>
<h3 id="_detecting_os">Detecting OS</h3><div style="clear:left"></div>
<div class="paragraph"><p>Specific distributions of Linux can be detected by looking for certain files.</p></div>
<div class="ulist"><ul>
<li>
<p>
RHEL/Centos: look for <tt>/etc/redhat-release</tt>
</p>
</li>
<li>
<p>
Debian: look for <tt>/etc/debian_version</tt>
</p>
</li>
<li>
<p>
Ubuntu: look for <tt>/etc/lsb-release</tt> and see if it contains Ubuntu
</p>
</li>
</ul></div>
<div class="paragraph"><div class="title">exampled: the daemon to run</div><p>For the purposes of illustration, suppose we have a daemon - we&#8217;ll call it
"exampled" (for example daemon).  It will be installed in this path,</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>/usr/bin/exampled</tt></pre>
</div></div>
<div class="paragraph"><p>We assume that <tt>exampled</tt> runs in the foreground (it does not fork and exit)
for the purposes of the job configuration below.</p></div>
<h3 id="_rhel_centos">RHEL/CentOS</h3><div style="clear:left"></div>
<div class="paragraph"><p>This platform uses sysvinit-style scripts.</p></div>
<div class="paragraph"><p>Place this in <tt>/etc/rc.d/init.d/exampled</tt>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>#!/bin/sh
#
# exampled: sample daemon
#
# chkconfig:   2345 26 89
# description: example daemon

. /etc/rc.d/init.d/functions

start()
{
    echo -n $"Starting exampled: "
    daemon /usr/bin/exampled &amp;
    touch /var/lock/subsys/exampled
    echo
}

stop()
{
    echo -n $"Shutting down exampled: "
    killproc exampled
    rm -f /var/lock/subsys/exampled
    echo
}

[ -f /usr/bin/exampled ] || exit 0

# see how we were called
case "$1" in
  start)
        start
        ;;
  stop)
        stop
        ;;
  restart|reload)
        stop
        start
        ;;
  condrestart)
        [ -e /var/lock/subsys/exampled ] &amp;&amp; (stop; start)
        ;;
  status)
        status exampled
        ;;
  *)
        echo $"Usage: $0 {start|stop|restart|reload|condrestart}"
        exit 1
esac

exit 0</tt></pre>
</div></div>
<div class="paragraph"><p>Add the new script (internally this symlinks it to the various runlevels):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>chkconfig --add exampled</tt></pre>
</div></div>
<div class="paragraph"><p>This makes symlinks in the runlevel-specific directories.</p></div>
<div class="paragraph"><p>Manually start up the job (on reboot, it should get started automatically):</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>/etc/init.d/exampled start</tt></pre>
</div></div>
<h3 id="_ubuntu">Ubuntu</h3><div style="clear:left"></div>
<div class="paragraph"><p>This platform uses "upstart" to manage jobs.</p></div>
<div class="paragraph"><p>Place this in <tt>/etc/init/exampled.conf</tt>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>  description "example daemon"
  start on filesystem
  stop on runlevel S
  respawn
  script
  exec /usr/bin/exampled
  end script</tt></pre>
</div></div>
<div class="paragraph"><p>It&#8217;s all ready to go. First time start up is just:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>start exampled</tt></pre>
</div></div>
<h3 id="_debian">Debian</h3><div style="clear:left"></div>
<div class="paragraph"><p>Place this in /etc/init.d/exampled:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>#! /bin/sh
### BEGIN INIT INFO
# Provides:          exampled
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: initscript to boot up exampled
# Description:       exampled is a example daemon
### END INIT INFO

# Author: Troy D. Hanson &lt;tdh@tkhanson.net&gt;
# based on /etc/init.d/skeleton from Debian 6.0.4

# PATH should only include /usr/* if it runs after the mountnfs.sh script
PATH=/sbin:/usr/sbin:/bin:/usr/bin
DESC="exampled"
NAME=exampled
DAEMON=/usr/bin/$NAME
DAEMON_ARGS=""
PIDFILE=/var/run/$NAME.pid
SCRIPTNAME=/etc/init.d/$NAME

# Exit if the package is not installed
[ -x "$DAEMON" ] || exit 0

# Read configuration variable file if it is present
[ -r /etc/default/$NAME ] &amp;&amp; . /etc/default/$NAME

# Load the VERBOSE setting and other rcS variables
. /lib/init/vars.sh

# Define LSB log_* functions.
# Depend on lsb-base (&gt;= 3.2-14) to ensure that this file is present
# and status_of_proc is working.
. /lib/lsb/init-functions

#
# Function that starts the daemon/service
#
do_start()
{
        # Return
        #   0 if daemon has been started
        #   1 if daemon was already running
        #   2 if daemon could not be started
        start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON --test &gt; /dev/null \
                || return 1
        start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON -- \
                $DAEMON_ARGS \
                || return 2
        # Add code here, if necessary, that waits for the process to be ready
        # to handle requests from services started subsequently which depend
        # on this one.  As a last resort, sleep for some time.
}

#
# Function that stops the daemon/service
#
do_stop()
{
        # Return
        #   0 if daemon has been stopped
        #   1 if daemon was already stopped
        #   2 if daemon could not be stopped
        #   other if a failure occurred
        start-stop-daemon --stop --quiet --retry=TERM/30/KILL/5 --pidfile $PIDFILE --name $NAME
        RETVAL="$?"
        [ "$RETVAL" = 2 ] &amp;&amp; return 2
        # Wait for children to finish too if this is a daemon that forks
        # and if the daemon is only ever run from this initscript.
        # If the above conditions are not satisfied then add some other code
        # that waits for the process to drop all resources that could be
        # needed by services started subsequently.  A last resort is to
        # sleep for some time.
        start-stop-daemon --stop --quiet --oknodo --retry=0/30/KILL/5 --exec $DAEMON
        [ "$?" = 2 ] &amp;&amp; return 2
        # Many daemons don't delete their pidfiles when they exit.
        rm -f $PIDFILE
        return "$RETVAL"
}

#
# Function that sends a SIGHUP to the daemon/service
#
do_reload() {
        #
        # If the daemon can reload its configuration without
        # restarting (for example, when it is sent a SIGHUP),
        # then implement that here.
        #
        start-stop-daemon --stop --signal 1 --quiet --pidfile $PIDFILE --name $NAME
        return 0
}

case "$1" in
  start)
        [ "$VERBOSE" != no ] &amp;&amp; log_daemon_msg "Starting $DESC" "$NAME"
        do_start
        case "$?" in
                0|1) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 0 ;;
                2) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 1 ;;
        esac
        ;;
  stop)
        [ "$VERBOSE" != no ] &amp;&amp; log_daemon_msg "Stopping $DESC" "$NAME"
        do_stop
        case "$?" in
                0|1) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 0 ;;
                2) [ "$VERBOSE" != no ] &amp;&amp; log_end_msg 1 ;;
        esac
        ;;
  status)
       status_of_proc "$DAEMON" "$NAME" &amp;&amp; exit 0 || exit $?
       ;;
  #reload|force-reload)
        #
        # If do_reload() is not implemented then leave this commented out
        # and leave 'force-reload' as an alias for 'restart'.
        #
        #log_daemon_msg "Reloading $DESC" "$NAME"
        #do_reload
        #log_end_msg $?
        #;;
  restart|force-reload)
        #
        # If the "reload" option is implemented then remove the
        # 'force-reload' alias
        #
        log_daemon_msg "Restarting $DESC" "$NAME"
        do_stop
        case "$?" in
          0|1)
                do_start
                case "$?" in
                        0) log_end_msg 0 ;;
                        1) log_end_msg 1 ;; # Old process is still running
                        *) log_end_msg 1 ;; # Failed to start
                esac
                ;;
          *)
                # Failed to stop
                log_end_msg 1
                ;;
        esac
        ;;
  *)
        #echo "Usage: $SCRIPTNAME {start|stop|restart|reload|force-reload}" &gt;&amp;2
        echo "Usage: $SCRIPTNAME {start|stop|status|restart|force-reload}" &gt;&amp;2
        exit 3
        ;;
esac

:</tt></pre>
</div></div>
<div class="paragraph"><p>Symlink things into place using:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>/usr/sbin/update-rc.d exampled defaults</tt></pre>
</div></div>
<div class="paragraph"><p>Then start it up:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>service exampled start</tt></pre>
</div></div>
<h3 id="_mac_os_x">Mac OS X</h3><div style="clear:left"></div>
<div class="paragraph"><p>Mac uses "launchd" to start daemons.</p></div>
<div class="paragraph"><p>Place this file in <tt>/Library/LaunchDaemons/exampled.plist</tt>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.appl.com/DTDs/PropertyList-1.0.dtd"&gt;
  &lt;plist version="1.0"&gt;
  &lt;dict&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;exampled&lt;/string&gt;
    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
      &lt;string&gt;/usr/bin/exampled&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;RunAtLoad&lt;/key&gt;
    &lt;true/&gt;
  &lt;/dict&gt;
  &lt;/plist&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>Load it in like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>launchctl load /Library/LaunchDaemons/exampled.plist</tt></pre>
</div></div>
<div class="paragraph"><p>Since we used the directive to start it upon load, it should already be running.</p></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2012-09-02 21:35:04 PDT
</div>
</div>
</body>
</html>
